<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>How to use the Shiny app to analyze causal graphs • causaloptim</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="How to use the Shiny app to analyze causal graphs">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">causaloptim</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.6.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/shinyapp.html">How to use the Shiny app to analyze causal graphs</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/sachsmc/causaloptim">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>How to use the Shiny app to analyze causal graphs</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/sachsmc/causaloptim/blob/master/vignettes/shinyapp.Rmd"><code>vignettes/shinyapp.Rmd</code></a></small>
      <div class="hidden name"><code>shinyapp.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(causaloptim)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="co">#&gt; Loading required package: igraph</span></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co">#&gt; Attaching package: 'igraph'</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="co">#&gt; The following objects are masked from 'package:stats':</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="co">#&gt;     decompose, spectrum</span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="co">#&gt; The following object is masked from 'package:base':</span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="co">#&gt;     union</span></a></code></pre></div>
<p>Run the Shiny application like so. The result is assigned to an objected called <code>results</code> so that you can save the results that are produced in the web interface.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">results &lt;-<span class="st"> </span><span class="kw"><a href="../reference/specify_graph.html">specify_graph</a></span>()</a></code></pre></div>
<p>A new window in your system’s default web browser is opened with the following interface:</p>
<div class="figure">
<img src="screen1.png" alt="Startup"><p class="caption">Startup</p>
</div>
<p>The instructions at the top provide details on how to specify the graph. The graph is divided into a left side and a right side. There is no confounding allowed between the left and right sides. All variables on the right side are confounded. Connections between the left and right sides must originate from the left. I.e, no connections from the right to left are allowed. On the left side, arbitrary connections are allowed and the model assumes that all nodes are observed and connected. On the right side, unmeasured variables are allowed, and the procedure assumes unmeasured confounding between all nodes. These restrictions are sufficient to ensure that the problem can be solved analytically using linear optimization.</p>
<p>In the main window below the text, Shift+click to add nodes. When a node is added, you are prompted to give it a name. Make sure that you use a valid R variable name. This means it cannot start with a number, and cannot contain spaces or special characters. Single capital letters are good choices, possibly with trailing numbers.</p>
<div class="figure">
<img src="screen2.png" alt="Naming nodes"><p class="caption">Naming nodes</p>
</div>
<p>Click on an existing node to select it, and shift+click on a node to change the name. Shift+drag to connect nodes. Remember than no edges may go from the right side to the left side. Click a node to select and then press ‘u’ to mark it as unobserved/latent. Click to select nodes/edges and press delete to remove. If there are problems selecting nodes, try restarting your browser.</p>
<div class="figure">
<img src="screen3.png" alt="Connections"><p class="caption">Connections</p>
</div>
<p>Once we have our graph specified, we can optionally make some annotations. You must specify the outcome of interest, and the exposure of interest. Select the outcome node and press ‘y’ to mark it as the outcome of interest, and then select the exposure node and press ‘e’ to mark it as the exposure of interest. The default causal contrast is the total effect. The exposure will be colored blue, and the outcome colored red.</p>
<div class="figure">
<img src="screen4.png" alt="Final graph"><p class="caption">Final graph</p>
</div>
<p>We now have a graph specified that is ready to be analyzed. Optionally, click an edge and press ‘m’ to enforce monotonicity for that connection. If you are ready to analyze the object click on the “Press to analyze the graph button”. The program interprets the graph, converts it to an <code>igraph</code> object with annotations, and prints the result from R. Inspect the resulting graph carefully so that you understand what is being analyzed.</p>
<div id="specifying-the-causal-effect-of-interest" class="section level2">
<h2 class="hasAnchor">
<a href="#specifying-the-causal-effect-of-interest" class="anchor"></a>Specifying the causal effect of interest</h2>
<p>The next step is to use the text box to specify the causal effect of interest. In our current example, we are interested in the causal risk difference in Y comparing X = 1 to X = 0, i.e., Y(X = 1) - Y(X = 0). The optimizer will compute bounds for the expected value of this quantity.</p>
<div class="figure">
<img src="screen5.png" alt="Interpreted graph"><p class="caption">Interpreted graph</p>
</div>
<p>Use the text box to describe your causal effect of interest. The effects must be of the form</p>
<pre><code>p{V11(X=a)=a; V12(X=a)=b;...} op1 p{V21(X=b)=a; V22(X=c)=b;...} op2 ...</code></pre>
<p>where <code>Vij</code> are names of variables in the graph, <code>a, b</code> are either 0 or 1, and <code>op</code> are either <code><a href="https://rdrr.io/r/base/Arithmetic.html">-</a></code> or <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code>. You can specify a single probability statement (i.e., no operator). Note that the probability statements begin with little p, and use curly braces, and items inside the probability statements are separated by <code>;</code>. The variables may be potential outcomes which are denoted by parentheses. Variables may also be nested inside potential outcomes. All of the following are valid effect statements:</p>
<pre><code>p{Y(X = 1) = 1} - p{Y(X = 0) = 1}
p{X(Z = 1) = 1; X(Z = 0) = 0}
p{Y(M(X = 0), X = 1) = 1} - p{Y(M(X = 0), X = 0) = 1}</code></pre>
<p>Back to our example, we specify the effect as</p>
<pre><code>p{Y(X = 1) = 1} - p{Y(X = 0) = 1}</code></pre>
<p>then click the “parse” button to fix the effect.</p>
</div>
<div id="specifying-constraints-optional" class="section level2">
<h2 class="hasAnchor">
<a href="#specifying-constraints-optional" class="anchor"></a>Specifying constraints (optional)</h2>
<p>Once the causal effect of interest has been specified, you may optionally specify some constraints. Click the button to start the constraint interface.</p>
<p>Here you can specify potential outcomes to constrain by writing the potential outcomes, values of their parents, and operators that determine the constraint (equalities or inequalities). In our example, we can specify monotonicity of the instrument Z by defining the constraint X(Z = 1) <span class="math inline">\(\geq\)</span> X(Z = 0):</p>
<pre><code>X(Z = 1) &gt;= X(Z = 0)</code></pre>
<p>then click parse.</p>
</div>
<div id="computation-of-the-bounds" class="section level2">
<h2 class="hasAnchor">
<a href="#computation-of-the-bounds" class="anchor"></a>Computation of the bounds</h2>
<p>Once you have inspected the graph, specified the causal effect, and understand what is being analyzed, press the final button to compute the bounds.</p>
<p>The results are summarized in plain text. The bounds are expressed as the minimum/maximum of a series of expressions involving the conditional probabilities of the observed variables. For more details on the method see the paper that doesn’t exist yet. The final button allows you to return all of the objects back to the R environment and store them in <code>results</code>.</p>
<p>The <code>results</code> object contains the graph, the parameterization and interpretation of the graph in terms of the variables and parameters, the bounds and log information about the optimization procedure, and an R function that implements the bounds:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(results)</a>
<a class="sourceLine" id="cb7-2" title="2"><span class="co">#&gt; [1] "graphres"       "obj"            "bounds.obs"     "constraints"   </span></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="co">#&gt; [5] "effect"         "boundsFunction"</span></a>
<a class="sourceLine" id="cb7-4" title="4"></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(results<span class="op">$</span>bounds.obs)</a>
<a class="sourceLine" id="cb7-6" title="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="co">#&gt; MAX {</span></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="co">#&gt; p00_0 - p00_1 - p10_1 - p01_1</span></a>
<a class="sourceLine" id="cb7-9" title="9"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb7-10" title="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-11" title="11"><span class="co">#&gt;  </span></a>
<a class="sourceLine" id="cb7-12" title="12"><span class="co">#&gt; MIN {</span></a>
<a class="sourceLine" id="cb7-13" title="13"><span class="co">#&gt; - p10_1 - p01_0 + 1</span></a>
<a class="sourceLine" id="cb7-14" title="14"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb7-15" title="15"></a>
<a class="sourceLine" id="cb7-16" title="16"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(results<span class="op">$</span>boundsFunction)</a>
<a class="sourceLine" id="cb7-17" title="17"><span class="co">#&gt; function (p00_0 = NULL, p00_1 = NULL, p10_0 = NULL, p10_1 = NULL, </span></a>
<a class="sourceLine" id="cb7-18" title="18"><span class="co">#&gt;     p01_0 = NULL, p01_1 = NULL, p11_0 = NULL, p11_1 = NULL) </span></a>
<a class="sourceLine" id="cb7-19" title="19"><span class="co">#&gt; c(lower = pmax(p00_0 - p00_1 - p10_1 - p01_1), upper = pmin(-p10_1 - </span></a>
<a class="sourceLine" id="cb7-20" title="20"><span class="co">#&gt;     p01_0 + 1))</span></a>
<a class="sourceLine" id="cb7-21" title="21"><span class="co">#&gt; &lt;environment: 0x0000000013e14668&gt;</span></a></code></pre></div>
<p>The results object can also be used to numerically simulate the bounds. Try using the <code>simulate_bounds</code> function.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">sim &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simulate_bounds.html">simulate_bounds</a></span>(results<span class="op">$</span>obj, results<span class="op">$</span>bounds.obs, <span class="dt">nsim =</span> <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb8-2" title="2"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(sim)</a>
<a class="sourceLine" id="cb8-3" title="3"><span class="co">#&gt;     objective bound.lower bound.upper</span></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="co">#&gt; 1 -0.13552261  -0.3349197   0.2855322</span></a>
<a class="sourceLine" id="cb8-5" title="5"><span class="co">#&gt; 2 -0.05671128  -0.3853780   0.2119402</span></a>
<a class="sourceLine" id="cb8-6" title="6"><span class="co">#&gt; 3 -0.01157279  -0.3465860   0.4037433</span></a>
<a class="sourceLine" id="cb8-7" title="7"><span class="co">#&gt; 4 -0.04364869  -0.3855189   0.2204576</span></a>
<a class="sourceLine" id="cb8-8" title="8"><span class="co">#&gt; 5  0.11673186  -0.2030344   0.5311919</span></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="co">#&gt; 6 -0.11390809  -0.4286097   0.2880000</span></a></code></pre></div>
<p>We also provide a helper function to print the bounds as latex equations. Use the <code>latex_bounds</code> function.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="kw"><a href="../reference/latex_bounds.html">latex_bounds</a></span>(results<span class="op">$</span>bounds.obs<span class="op">$</span>bounds, results<span class="op">$</span>obj<span class="op">$</span>parameters))</a></code></pre></div>
<p><span class="math display">\[ 
 \mbox{Lower bound} = P(X = 0, Y = 0 | Z = 0) - P(X = 0, Y = 0 | Z = 1) - P(X = 1, Y = 0 | Z = 1) - P(X = 0, Y = 1 | Z = 1) 
 \]</span> <span class="math display">\[ 
 \mbox{Upper bound} = - P(X = 1, Y = 0 | Z = 1) - P(X = 0, Y = 1 | Z = 0) + 1 
 \]</span></p>
<p>Please sends any bugs or feedback to <a href="mailto:michael.sachs@ki.se" class="email">michael.sachs@ki.se</a> or file an issue on <a href="https://github.com/sachsmc/causaloptim" class="uri">https://github.com/sachsmc/causaloptim</a> .</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#specifying-the-causal-effect-of-interest">Specifying the causal effect of interest</a></li>
      <li><a href="#specifying-constraints-optional">Specifying constraints (optional)</a></li>
      <li><a href="#computation-of-the-bounds">Computation of the bounds</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Michael C Sachs, Erin E Gabriel, Arvid Sjölander.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
